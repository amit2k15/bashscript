import pyzabbix
import pandas as pd

# Specify Zabbix server details
zabbix_server = 'https://your_zabbix_server.com'
username = 'your_zabbix_username'
password = 'your_zabbix_password'

# Specify the Zabbix host group and time interval
host_group_name = 'Your Host Group Name'
time_from = '2023-04-01 00:00:00'
time_till = '2023-04-30 23:59:59'

# Connect to the Zabbix server
zapi = pyzabbix.ZabbixAPI(zabbix_server)
zapi.login(username, password)

# Get the hosts in the specified host group
host_group = zapi.hostgroup.get(filter={'name': host_group_name}, selectHosts='extend')
hosts = [host['hosts'][0]['host'] for host in host_group]

# Loop through the hosts and get the CPU and memory data for each host
for host in hosts:
    # Get the CPU and memory utilization data
    cpu_util = zapi.history.get(item='system.cpu.util[,idle]', host=host, time_from=time_from, time_till=time_till)
    mem_util = zapi.history.get(item='vm.memory.util[available]', host=host, time_from=time_from, time_till=time_till)

    # Convert the data to a pandas DataFrame
    cpu_util_df = pd.DataFrame(cpu_util)
    mem_util_df = pd.DataFrame(mem_util)

    # Create a new Excel sheet for each host and write the data to the sheet
    with pd.ExcelWriter(f'{host}.xlsx') as writer:
        cpu_util_df.to_excel(writer, sheet_name='CPU Utilization', index=False)
        mem_util_df.to_excel(writer, sheet_name='Memory Utilization', index=False)
