#!/bin/bash

if [[ $# -ne 4 ]]; then
    echo "Usage: $0 <hostname> <username> <password> <port>"
    exit 1
fi

hostname=$1
username=$2
password=$3
port=$4

# Check authentication status
auth_result=$(expect -c "
spawn sftp -oBatchMode=no -oPort=$port $username@$hostname
expect {
    \"assword:\" {
        send \"$password\n\"
        expect {
            \"sftp>\" {
                exit 0
            }
            \"Permission denied\" {
                exit 1
            }
        }
    }
    \"Connection refused\" {
        exit 2
    }
    \"No route to host\" {
        exit 3
    }
    timeout {
        exit 4
    }
}
")

auth_status=$?

# Check response time
response_time=$( { time -p (echo "quit" | sftp -oBatchMode=no -oPort=$port $username@$hostname &>/dev/null); } 2>&1 | grep real | awk '{print $2}' )

# Output results
echo "Authentication Status: "
case $auth_status in
    0)
        echo "Success"
        ;;
    1)
        echo "Failure: Incorrect username or password"
        ;;
    2)
        echo "Failure: Connection refused"
        ;;
    3)
        echo "Failure: No route to host"
        ;;
    4)
        echo "Failure: Timeout"
        ;;
    *)
        echo "Unknown error"
        ;;
esac

echo "Response Code: $auth_status"
echo "Response Time: $response_time seconds"
