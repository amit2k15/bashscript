#!/bin/bash

# Function to check SFTP authentication
function check_sftp_authentication() {
    local host="$1"
    local user="$2"
    local password="$3"
    local port="$4"

    # Attempt SFTP connection and check the exit code
    sftp_output=$(sshpass -p "$password" sftp -oPort="$port" -oBatchMode=yes "$user"@"$host" 2>&1)
    exit_code=$?

    if [ $exit_code -eq 0 ]; then
        echo "SFTP authentication successful for $user@$host:$port"
    else
        echo "SFTP authentication failed for $user@$host:$port"
        echo "Error message: $sftp_output"
    fi
}

# Main script

# Check if sshpass is installed
if ! command -v sshpass &>/dev/null; then
    echo "sshpass is not installed. Please install it before running this script."
    exit 1
fi

# Check if all required arguments are provided
if [ $# -ne 4 ]; then
    echo "Usage: $0 <SFTP_HOST> <SFTP_USER> <SFTP_PASSWORD> <SFTP_PORT>"
    exit 1
fi

SFTP_HOST="$1"
SFTP_USER="$2"
SFTP_PASSWORD="$3"
SFTP_PORT="$4"

check_sftp_authentication "$SFTP_HOST" "$SFTP_USER" "$SFTP_PASSWORD" "$SFTP_PORT"
