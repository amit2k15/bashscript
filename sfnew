#!/bin/bash

if [ "$#" -ne 4 ]; then
  echo "Usage: $0 <host> <user> <password> <port>"
  exit 1
fi

HOST=$1
USER=$2
PASSWORD=$3
PORT=$4

expect <<EOF
spawn sftp -P $PORT $USER@$HOST
expect {
  "yes/no" {
    send "yes\r"
    exp_continue
  }
  "password:" {
    send "$PASSWORD\r"
  }
}
expect {
  "Authentication failed." {
    puts "Authentication failed."
    exit 1
  }
  "sftp>" {
    puts "Authentication successful."
    send "exit\r"
  }
}
expect eof
EOF
