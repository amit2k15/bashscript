#!/bin/bash

# Check if all required arguments are provided
if [ $# -ne 4 ]; then
  echo "Usage: $0 <hostname> <username> <password> <sftp_port>"
  exit 1
fi

# Assign command-line arguments to variables
hostname=$1
username=$2
password=$3
sftp_port=$4

# Temporary file to store the sftp commands
commands_file=$(mktemp)

# Generate sftp commands file
cat << EOF > "$commands_file"
open $hostname $sftp_port
user $username $password
bye
EOF

# Run sftp and capture the output
output=$(sftp -b "$commands_file" 2>&1)

# Parse the output to extract authentication status, response code, and response time
authentication_status=""
response_code=""
response_time=""

if echo "$output" | grep -q "Authentication successful"; then
  authentication_status="Authenticated"
  response_code="0"
else
  authentication_status="Not Authenticated"
  response_code="1"
fi

if echo "$output" | grep -q "timed out"; then
  response_time="Timed out"
else
  response_time="Normal"
fi

# Clean up the temporary commands file
rm "$commands_file"

# Print the results
echo "Authentication Status: $authentication_status"
echo "Response Code: $response_code"
echo "Response Time: $response_time"
