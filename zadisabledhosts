import requests
import json
from openpyxl import Workbook

# Zabbix API credentials
ZABBIX_URL = 'https://your_zabbix_instance/api_jsonrpc.php'
ZABBIX_USER = 'your_username'
ZABBIX_PASSWORD = 'your_password'

# Zabbix API headers
headers = {'Content-Type': 'application/json-rpc'}

# Zabbix API authentication
auth_payload = {
    'jsonrpc': '2.0',
    'method': 'user.login',
    'params': {
        'user': ZABBIX_USER,
        'password': ZABBIX_PASSWORD,
    },
    'id': 1,
}

response = requests.post(ZABBIX_URL, data=json.dumps(auth_payload), headers=headers, verify=False)
auth_result = response.json()
auth_token = auth_result['result']

# Fetch disabled items
items_payload = {
    'jsonrpc': '2.0',
    'method': 'item.get',
    'params': {
        'output': ['itemids', 'name', 'status'],
        'filter': {'status': 1},  # 1 for disabled items
        'selectHosts': ['host', 'hostid'],
    },
    'auth': auth_token,
    'id': 2,
}

response = requests.post(ZABBIX_URL, data=json.dumps(items_payload), headers=headers, verify=False)
items_result = response.json()

# Create Excel report
wb = Workbook()
ws = wb.active
ws.append(['Host', 'Host Group', 'Item Name'])

for item in items_result['result']:
    host = item['hosts'][0]['host']
    host_group = item['hosts'][0]['hostid']  # You may need to fetch host group separately using hostid
    item_name = item['name']
    ws.append([host, host_group, item_name])

# Save the report
wb.save('disabled_items_report.xlsx')
